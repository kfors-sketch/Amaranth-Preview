<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content=" <link rel="icon" href="/assets/img/favicon.ico" type="image/ico+xml" />
  <link rel="stylesheet" href="/assets/css/styles.css" />
  <title>Home</title>

  <!-- Header fixes scoped to Order ge: stack & center the logo like Shop -->
  <style>
    [data-ge="order"] .site-header { text-align: center; }
    [data-ge="order"] .header-inner { display: block; } /* avoid odd flex interactions */
    [data-ge="order"] .logo {
      display: flex;
      flex-direction: column;     /* stack image above the title line */
      align-items: center;
      gap: 8px;
      text-decoration: none;
    }
    [data-ge="order"] .logo sn {
      display: block;
      text-align: center;
      font-weight: 700;
      font-size: clamp(1.05rem, 2.2vw, 1.4rem);
      color: #1f2937;
    }
    /* Hide Registration & Directory here too */
    [data-ge="order"] .nav a[href*="registration"],
    [data-ge="order"] .nav a[href*="directory"] { display: none !important; }
    /* Center the Order ge title */
    [data-ge="order"] h1 {
      text-align: center;
      margin: 20px 0 14px;
      font-size: clamp(1.5rem, 2.6vw, 2rem);
      font-weight: 800;
    }
    /* Optional: Banquets-style frosted cards on Order ge */
    [data-ge="order"] .card{
      background: rgba(255,255,255,0.40);
      border-color: rgba(229,231,235,0.45);
      box-shadow: 0 2px 10px rgba(0,0,0,0.06);
      backdrop-filter: saturate(120%) blur(2px);
      -webkit-backdrop-filter: saturate(120%) blur(2px);
    }
  </style>
</head>

<body data-org="- <header class="site-header">
    <div class="container header-inner">
      <!-- Centered, stacked logo + title -->
      <a class="logo" href="/- <img src="/assets/img/logo.svg" alt="logo" />
        <sn> </sn>
      </a>

      <!-- Clean nav; Registration/Directory removed -->
      <nav id="nav" class="nav">
        <a href="/- </a>
        <a href="/- </a>
        <a href="/- </a>
        <a href="/- </a>
      </nav>
    </div>
  </header>

  <main class="container mt-lg">
    <h1>Order</h1>

    <section class="card">
      <h2>Purchaser</h2>
      <div class="grid-2">
        <label>Full name<input id="p_name" type="text" required></label>
        <label>Title (optional)<input id="p_title" type="text"></label>
      </div>
      <div class="grid-2">
        <label>Email<input id="p_email" type="email" required></label>
        <label>Phone<input id="p_phone" type="tel" required></label>
      </div>
      <div class="grid-3">
        <label>Address line 1<input id="p_addr1" type="text" required></label>
        <label>Address line 2<input id="p_addr2" type="text"></label>
        <label>City<input id="p_city" type="text" required></label>
      </div>
      <div class="grid-3">
        <label>State/Province<input id="p_state" type="text" required></label>
        <label>Postal code<input id="p_zip" type="text" required></label>
        <label>Country<input id="p_country" type="text" value="US" required></label>
      </div>
    </section>

    <section class="card mt-lg">
      <div style="display:flex;justify-content:sce-between;align-items:center;">
        <h2>Attendees</h2>
        <button class="btn" id="add-attendee">+ Add attendee</button>
      </div>
      <div id="attendee-list"></div>
    </section>

    <section class="card mt-lg">
      <h2>Add Items (Registration, Directory, Shop)</h2>
      <div id="store-list" class="grid-3"></div>
    </section>

    <section class="card mt-lg">
      <h2>Extra Donation (optional)</h2>
      <div id="extra-donation"></div>
    </section>

    <section class="card mt-lg">
      <div style="display:flex;justify-content:sce-between;align-items:center;">
        <h2>Summary</h2>
        <div><strong>Total: </strong><sn id="order-total">$0.00</sn></div>
      </div>

      <div id="order-lines" class="mt"></div>
      <div id="fees-line" class="tiny" style="margin-top:.5rem;"></div>

      <button id="checkout" class="btn btn-primary mt">Go to Checkout</button>
      <p class="tiny">You’ll be redirected to Stripe’s secure checkout.</p>
    </section>
  
<section class="panel">
  
<h2>Review & Checkout</h2>

<section class="panel">
  <h3>Orderer Information</h3>
  <form id="ordererForm" class="orderer-form">
    <div class="row">
      <input name="name" placeholder="Your full name" required>
      <input name="email" type="email" placeholder="Your email" required>
    </div>
    <div class="row">
      <input name="phone" placeholder="Phone (optional)">
      <input name="address" placeholder="Mailing address (optional)">
    </div>
    <button id="saveOrderer" type="submit">Save Contact Info</button>
  </form>
  <p id="ordererSaved" style="display:none"><em>Saved.</em></p>
</section>

  <div id="order-list"></div>
  <hr>
  <div id="order-summary"></div>
  <div style="margin-top:12px">
    <button id="clearCart">Clear Order</button>
  </div>
</section>
</main>


  <!-- Keep your existing scripts -->
  <script src="/assets/js/render-multi.js" defer></script>
  <script src="/assets/js/main.js" defer></script>

<script>
function money(n){ return '$' + (Math.round(n*100)/100).toFixed(2); }
document.addEventListener('DOMContentLoaded', function(){
  Cart.load();
  const list = document.getElementById('order-list');
  const sum = document.getElementById('order-summary');
  function render(){
    const st = Cart.get();
    // Group lines by attendee
    const byA = {};
    st.lines.forEach(l => { (byA[l.attendeeId] ||= []).push(l); });
    list.innerHTML = Object.entries(byA).map(([aid, lines]) => {
      const a = st.attendees.find(x=>x.id===aid) || {name:'(Unassigned)'};
      const rows = lines.map(l => `
        <tr>
          <td>${l.itemName}</td>
          <td>${l.qty}</td>
          <td>${money(l.unitPrice)}</td>
          <td>${money(l.unitPrice * l.qty)}</td>
          <td><button data-remove="${l.id}">Remove</button></td>
        </tr>`).join('');
      return `
        <div class="att-block">
          <h3>${a.name||''} <small>${a.email||''}</small> <em>${a.title||''}</em></h3>
          <table class="order-table">
            <thead><tr><th>Item</th><th>Qty</th><th>Price</th><th>Line Total</th><th></th></tr></thead>
            <tbody>${rows}</tbody>
          </table>
        </div>`;
    }).join('') || '<p>No items yet.</p>';
    list.querySelectorAll('button[data-remove]').forEach(b=> b.onclick = ()=>{ Cart.removeLine(b.dataset.remove); });

    const t = Cart.totals();
    sum.innerHTML = `
      <div><strong>Subtotal</strong>: ${money(t.subtotal)}</div>
      <div>Fee (${t.pct}% + ${money(t.flat)}): ${money(t.fee)}</div>
      <hr>
      <div style="font-size:1.1em"><strong>Total</strong>: ${money(t.total)}</div>
      <p><small>The fee helps cover online processing costs.</small></p>
    `;
  }
  render();
  window.addEventListener('cart:updated', render);
  document.getElementById('clearCart').onclick = ()=>{ Cart.clear(); };
});
</script>
<style>
.order-table{width:100%;border-collapse:collapse}
.order-table th, .order-table td{border-bottom:1px solid #ddd;padding:6px;text-align:left}
.att-block{margin-bottom:16px}
</style>


<script src="/assets/js/site-settings.js"></script>
<script src="/assets/js/items.js"></script>
<script src="/assets/js/banquets.js"></script>
<script src="/assets/js/cart.js"></script>


<script>
// Orderer info load/save
document.addEventListener('DOMContentLoaded', function(){
  Cart.load();
  const f = document.getElementById('ordererForm');
  const saved = Cart.getOrderer();
  if (saved){
    if (saved.name) f.elements['name'].value = saved.name;
    if (saved.email) f.elements['email'].value = saved.email;
    if (saved.phone) f.elements['phone'].value = saved.phone;
    if (saved.address) f.elements['address'].value = saved.address;
  }
  f.addEventListener('submit', function(e){
    e.preventDefault();
    const fd = new FormData(f);
    Cart.setOrderer({
      name: fd.get('name') || '',
      email: fd.get('email') || '',
      phone: fd.get('phone') || '',
      address: fd.get('address') || ''
    });
    document.getElementById('ordererSaved').style.display = 'block';
    setTimeout(()=> document.getElementById('ordererSaved').style.display='none', 1500);
  }, false);
});
</script>
<style>
.orderer-form .row{display:flex;gap:10px;flex-wrap:wrap;margin:6px 0}
.orderer-form input{flex:1;min-width:220px;padding:8px;border:1px solid #ccc;border-radius:8px}
.orderer-form button{margin-top:6px}
</style>

</body>
</html>
