<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Banquets and related items for registration.">
  <link rel="icon" href="assets/img/favicon.svg" type="image/svg+xml">
  <link rel="stylesheet" href="assets/css/styles.css?v=banquets-v7">
  <title>Banquets</title>
</head>

<body data-page="banquets">
  <div class="wallpaper" style="--wallpaper: url('/assets/img/wallpaper.jpg')"></div>

  <!-- Header -->
  <header class="site-header">
    <div class="container header-inner">
      <a class="logo" href="home.html">
        <img src="assets/img/logo.svg" alt="Logo">
      </a>
      <span class="site-title">Order of the Amaranth</span>
      <nav class="site-nav nav">
        <a href="home.html">Home</a>
        <span class="nav-current">Banquets</span>
        <a href="grand-court-addons.html">Grand Court Add-Ons</a>
        <a href="product-catalog.html" data-catalog-link>Product Catalog</a>
        <a href="order.html">Order</a>
      </nav>
    </div>
  </header>

  <main class="container mt-lg">
    <h1 class="page-title">Banquets</h1>

    <div id="banquet-list" class="grid-2"></div>

    <!-- Attendees Card -->
    <section class="card" style="background:rgba(255,255,255,0.40);backdrop-filter:saturate(120%) blur(2px);-webkit-backdrop-filter:saturate(120%) blur(2px);border:1px solid rgba(229,231,235,0.45);border-radius:12px;box-shadow:0 2px 10px rgba(0,0,0,.06);padding:12px;">
      <h2>Attendees</h2>
      <form id="attForm" class="att-form">
        <div class="grid-3">
          <input name="name" placeholder="Name *" required>
          <input name="email" type="email" placeholder="Email *" required>
          <input name="phone" type="tel" placeholder="Phone *" required>
        </div>
        <div class="grid-3">
          <input name="title" placeholder="Title">
          <input name="notes" placeholder="Dietary notes">
          <input name="addr1" placeholder="Address line 1 *" required>
        </div>
        <div class="grid-3">
          <input name="addr2" placeholder="Address line 2">
          <input name="city" placeholder="City *" required>
          <input name="state" placeholder="State/Province *" required>
        </div>
        <div class="grid-3">
          <input name="postal" placeholder="Postal code *" required>
          <input name="country" placeholder="Country *" value="US" required>
          <span></span>
        </div>
        <button type="submit">Add attendee</button>
      </form>

      <div id="attendees"></div>
    </section>

    <!-- Banquet List -->
    <section class="panel">
      <h2>Banquets</h2>
      <div id="banquets"></div>
    </section>
  </main>

  <footer class="site-footer">
    <div class="container tiny">Â© 2025</div>
  </footer>

  <!-- Core Scripts -->
  <script src="assets/js/main.js" defer></script>
  <script src="assets/js/site-settings.js"></script>
  <script src="assets/js/items.js"></script>
  <script src="assets/js/banquets.js"></script>
  <script src="assets/js/cart.js"></script>
  <script src="assets/js/data-store.js"></script>
  <script src="assets/js/site-boot.js"></script>

  <!-- Maintenance Check -->
  <script>
  (async () => {
    try {
      const resp = await fetch('/api/router?type=settings');
      const data = await resp.json();
      const on = data?.effective?.MAINTENANCE_ON ?? data?.MAINTENANCE_ON;
      const msg = data?.effective?.MAINTENANCE_MESSAGE ?? data?.MAINTENANCE_MESSAGE;

      if (on === 'true' || on === true) {
        document.body.innerHTML = `
          <div style="display:flex;flex-direction:column;justify-content:center;align-items:center;height:100vh;background:#fef2f2;color:#b91c1c;font-family:sans-serif;text-align:center;padding:20px">
            <h1 style="font-size:2em;margin-bottom:12px;">ðŸ›  Under Maintenance</h1>
            <p style="font-size:1.2em;max-width:500px;">
              ${msg || 'The site is temporarily unavailable. Please check back soon.'}
            </p>
          </div>
        `;
      }
    } catch (err) {
      console.error('Maintenance check failed:', err);
    }
  })();
  </script>

  <!-- âœ… Hide Product Catalog Link if No Visible Items -->
  <script>
  (async function(){
    let items = [];
    try {
      const r = await fetch('/api/router?type=catalog', { cache: 'no-store' });
      const j = await r.json();
      if (Array.isArray(j?.items)) items = j.items;
    } catch(e){}

    if (!items.length && window.CATALOG_ITEMS) items = window.CATALOG_ITEMS;

    const now = Date.now();
    function isVisible(i){
      if (i.active === false) return false;
      const s = i.publishStart ? Date.parse(i.publishStart) : null;
      const e = i.publishEnd   ? Date.parse(i.publishEnd)   : null;
      return (s==null || now >= s) && (e==null || now <= e);
    }

    const hasVisible = (items||[]).some(isVisible);
    if (!hasVisible){
      const link = document.querySelector('[data-catalog-link]');
      if (link) link.style.display = 'none';
    }
  })();
  </script>

  <style>
    .att-form input { margin:4px; padding:6px; }
    .att-card {
      display:flex; gap:8px; align-items:center; justify-content:space-between;
      background:rgba(255,255,255,0.78); border:1px solid rgba(0,0,0,0.06);
      border-radius:10px; padding:8px; margin:6px 0
    }
    .banquet-card {
      background:rgba(255,255,255,0.40); border:1px solid rgba(229,231,235,0.45);
      border-radius:10px; padding:12px; box-shadow:0 2px 10px rgba(0,0,0,0.06);
      backdrop-filter:saturate(120%) blur(2px); -webkit-backdrop-filter:saturate(120%) blur(2px);
    }
    .grid-3 { display:grid; grid-template-columns:repeat(3,minmax(0,1fr)); gap:8px; }
  </style>

</body>
</html>