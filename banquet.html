<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content=" <link rel="icon" href="/assets/img/favicon.svg" type="image/svg+xml">
  <link rel="stylesheet" href="/assets/css/styles.css?v=bg2-layers">
  <title>Home</title>
</head>
<body data-org="- <header class="site-header">
  <div class="container header-inner">
    <a class="logo" href="/- <img src="/assets/img/logo.svg" alt="logo">
    </a>
    <nav id="nav" class="nav">
      <a href="/- </a>
      <a href="/- </a>
      <a href="/- </a>
      <a href="/- </a>
    </nav>
  </div>
</header>

<main class="container mt-lg">
  <h1 class="ge-title">Banquets</h1>
  <div id="banquet-list" class="grid-2"></div>

<section class="panel">
  <h2>Attendees</h2>
  <form id="attForm" class="att-form">
    <input name="name" placeholder="Name" required>
    <input name="email" type="email" placeholder="Email">
    <input name="title" placeholder="Title">
    <button>Add attendee</button>
  </form>
  <div id="attendees"></div>
</section>

<section class="panel">
  <h2>Banquets</h2>
  <div id="banquets"></div>
</section>
</main>


<footer class="site-footer">
  <div class="container tiny">© 2025</div>
</footer>

<script src="/assets/js/main.js" defer></script>
<script src="/assets/js/render-multi.js" defer></script>

<script>
document.addEventListener('DOMContentLoaded', function(){
  Cart.load();
  const list = document.getElementById('attendees');
  const form = document.getElementById('attForm');
  function renderAttendees(){
    const st = Cart.get();
    list.innerHTML = st.attendees.map(a=>`
      <div class="att-card">
        <strong>${a.name||''}</strong> <small>${a.email||''}</small> <em>${a.title||''}</em>
        <button data-del="${a.id}">Remove</button>
      </div>
    `).join('');
    list.querySelectorAll('button[data-del]').forEach(btn=>{
      btn.onclick=()=>{ Cart.removeAttendee(btn.dataset.del); renderAttendees(); };
    });
  }
  form.onsubmit = (e)=>{
    e.preventDefault();
    const fd = new FormData(form);
    const id = Cart.addAttendee({name:fd.get('name'),email:fd.get('email'),title:fd.get('title')});
    form.reset(); renderAttendees();
  };
  renderAttendees();

  // Banquets
  const wrap = document.getElementById('banquets');
  function attendeeSelect(){
    const s = document.createElement('select');
    const a = Cart.get().attendees;
    if (a.length===0){ s.disabled=true; const opt=document.createElement('option'); opt.textContent='Add attendee first'; s.appendChild(opt); return s; }
    a.forEach(at=>{ const opt=document.createElement('option'); opt.value=at.id; opt.textContent=at.name || at.email; s.appendChild(opt); });
    return s;
  }
  function addBanquet(b){
    if(b.active===false) return;
    const div = document.createElement('div');
    div.className = 'banquet-card';
    div.innerHTML = `
      <h3>${b.name}</h3>
      <div><small>${b.datetime||''}</small></div>
      <p>${b.description||''}</p>
      <label>Ticket:
        <select class="opt"></select>
      </label>
      <div class="diet">Dietary: ${(b.dietary||[]).map(d=>`<label><input type="checkbox" value="${d}"> ${d}</label>`).join(' ')}
        <div><input class="other" placeholder="Other dietary notes"></div>
      </div>
      <div class="assign"></div>
      <button class="add">Add to Order</button>
    `;
    const optSel = div.querySelector('.opt');
    (b.options||[]).forEach(o=>{
      const op = document.createElement('option');
      op.value = JSON.stringify(o);
      op.textContent = `${o.label} — $${o.price.toFixed(2)}`;
      optSel.appendChild(op);
    });
    div.querySelector('.assign').appendChild(attendeeSelect());
    div.querySelector('.add').onclick = ()=>{
      const sel = div.querySelector('.assign select');
      if(!sel || !sel.value){ alert('Add/select an attendee first.'); return; }
      const chosen = JSON.parse(optSel.value);
      const diet = [...div.querySelectorAll('.diet input[type="checkbox"]:checked')].map(x=>x.value);
      const other = div.querySelector('.diet .other').value;
      Cart.addLine({
        attendeeId: sel.value,
        itemType: 'banquet',
        itemId: b.id + ":" + chosen.id,
        itemName: `${b.name} – ${chosen.label}`,
        qty: 1,
        unitPrice: chosen.price,
        meta: {dietFlags: diet, dietOther: other, event: b.datetime||""}
      });
      alert('Banquet added');
    };
    wrap.appendChild(div);
  }
  (window.BANQUETS||[]).forEach(addBanquet);
});
</script>
<style>
.att-form input{margin:4px;padding:6px}
.att-card{display:flex;gap:8px;align-items:center;justify-content:space-between;background:rgba(255,255,255,0.78);border:1px solid rgba(0,0,0,0.06);border-radius:10px;padding:8px;margin:6px 0}
.banquet-card{background:rgba(255,255,255,0.78);border:1px solid rgba(0,0,0,0.06);border-radius:10px;padding:12px;margin:10px 0}
</style>


<script src="/assets/js/site-settings.js"></script>
<script src="/assets/js/items.js"></script>
<script src="/assets/js/banquets.js"></script>
<script src="/assets/js/cart.js"></script>

</body>
</html>
