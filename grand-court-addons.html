<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Grand Court Add-Ons">
  <link rel="icon" href="assets/img/favicon.svg" type="image/svg+xml">
  <link rel="stylesheet" href="assets/css/styles.css?v=addons-v3">
  <title>Grand Court Add-Ons</title>
</head>

<body data-page="addons">
  <div class="wallpaper" style="--wallpaper: url('/assets/img/wallpaper.jpg')"></div>
  <!-- Header / Logo + Nav -->
  <header class="site-header">
    <div class="container header-inner">
      <a class="logo" href="home.html">
        <img src="assets/img/logo.svg" alt="Logo">
      </a>
      <span class="site-title">Order of the Amaranth</span>
      <nav class="site-nav nav">
        <a href="home.html">Home</a>
        <a href="banquet.html">Banquets</a>
        <span class="nav-current">Grand Court Add-Ons</span>
        <a href="product-catalog.html">Product Catalog</a>
        <a href="order.html">Order</a>
      </nav>
    </div>
  </header>

  <main class="container mt-lg">
    <h1 class="page-title" style="text-align:center;font-weight:800;">Grand Court Add-Ons</h1>

    <!-- Attendees (shared with Banquets/Order via Cart) -->
    <section class="card" style="background:rgba(255,255,255,0.40);backdrop-filter:saturate(120%) blur(2px);-webkit-backdrop-filter:saturate(120%) blur(2px);">
      <h2>Attendees</h2>
      <form id="attForm" class="att-form">
        <input name="name" placeholder="Name" required>
        <input name="email" type="email" placeholder="Email">
        <input name="title" placeholder="Title">
        <input name="notes" placeholder="Dietary notes">
        
        <button type="submit">Add attendee</button>
      </form>
      <div id="attendees"></div>
    </section>

    <!-- Add-ons grid (cards rendered and wired by JS) -->
    <section class="grid-2 mt-lg" id="addonsGrid"></section>
  </main>

  <footer class="site-footer">
    <div class="container tiny">Â© 2025</div>
  </footer>

  <style>
    .att-form input{margin:4px;padding:6px}
    .att-card{display:flex;gap:8px;align-items:center;justify-content:space-between;background:rgba(255,255,255,0.78);border:1px solid rgba(0,0,0,0.06);border-radius:10px;padding:8px;margin:6px 0}
    .addon .row{display:flex;flex-wrap:wrap;gap:12px;align-items:flex-end}
    .addon label{display:flex;flex-direction:column;gap:6px}
    .addon input,.addon select{padding:.55rem .7rem;border:1px solid #d1d5db;border-radius:.5rem;background:rgba(255,255,255,0.9)}
  </style>

  <!-- Core site scripts (order matters) -->
  <script src="assets/js/site-settings.js"></script>
  <script src="assets/js/items.js"></script>
  <script src="assets/js/banquets.js"></script>
  <script src="assets/js/cart.js"></script>
  <script src="assets/js/data-store.js"></script>
  <script src="assets/js/site-boot.js"></script>

  <!-- Page JS (new) -->
  <script src="assets/js/grand-court-addons.js"></script>

  <script>
  // Strip attendeeNotes for any lines added from this Add-Ons page.
  document.addEventListener('DOMContentLoaded', function(){
    if (document.body && document.body.dataset && document.body.dataset.page === 'addons' && window.Cart && typeof Cart.addLine === 'function'){
      const _add = Cart.addLine.bind(Cart);
      Cart.addLine = function(line){
        try{
          // Deep-clone to avoid mutating caller's object
          const copy = JSON.parse(JSON.stringify(line || {}));
          if (copy && copy.meta && Object.prototype.hasOwnProperty.call(copy.meta, 'attendeeNotes')){
            delete copy.meta.attendeeNotes;
          }
          return _add(copy);
        }catch(e){
          // On any error, fall back to original add
          return _add(line);
        }
      };
    }
  });
  </script>


  <script>
  // Ensure notes entered here are saved on the attendee profile,
  // but Add-Ons lines themselves remain note-free (see addLine wrapper below).
  document.addEventListener('DOMContentLoaded', function(){
    var attForm = document.getElementById('attForm');
    if (attForm && window.Cart && typeof Cart.addAttendee === 'function'){
      var _addAtt = Cart.addAttendee.bind(Cart);
      Cart.addAttendee = function(a){
        try{
          var notesInput = attForm.querySelector('[name="notes"]');
          var n = notesInput ? String(notesInput.value || '').trim() : '';
          if (n && (!a || !a.notes)){
            a = Object.assign({}, a || {}, { notes: n });
          }
        }catch(e){}
        return _addAtt(a);
      };
    }
  });
  </script>
<script>
(async () => {
  try {
    const resp = await fetch('/api/admin/settings.js');
    const data = await resp.json();

    if (data.MAINTENANCE_ON === 'true' || data.MAINTENANCE_ON === true) {
      document.body.innerHTML = `
        <div style="display:flex;flex-direction:column;justify-content:center;align-items:center;height:100vh;background:#fef2f2;color:#b91c1c;font-family:sans-serif;text-align:center;padding:20px">
          <h1 style="font-size:2em;margin-bottom:12px;">ðŸ›  Under Maintenance</h1>
          <p style="font-size:1.2em;max-width:500px;">
            ${data.MAINTENANCE_MESSAGE || 'The site is temporarily unavailable. Please check back soon.'}
          </p>
        </div>
      `;
    }
  } catch (err) {
    console.error('Maintenance check failed:', err);
  }
})();
</script>

</body>
</html>
